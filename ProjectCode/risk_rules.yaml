# risk_rules.yaml















# Each rule has: id, title, description, when, mitigations (list), stride (optional), severity_hint, priority















# 'when' defines where to apply the rule and simple conditions.































- id: api_missing_security















  title: "API missing security schemes"















  description: "OpenAPI spec has no securitySchemes or global security; public API likely lacks authentication."















  when:















    target: "component"















    component_type: "api"















    properties:















      security_schemes:















        exists: false















  mitigations:















    - "Define and require securitySchemes in OpenAPI (e.g., OAuth2/JWT) for {component_id}"















    - "Require global 'security' definitions on operations that expose sensitive data."















  stride: "Spoofing"















  severity_hint: "high"















  priority: "high"































- id: api_admin_endpoint















  title: "Admin endpoint exposed publicly"















  description: "API contains paths with 'admin' or 'manage' which may expose privileged functionality."















  when:















    target: "flow"















    path_contains: "/admin"















    crosses_trust_boundary: true















  mitigations:















    - "Restrict access to admin endpoints: use IP allow-lists, strong auth, and MFA for {component_id}"















    - "Ensure admin paths are not publicly discoverable and appear only behind internal networks."















  stride: "Elevation of Privilege"















  severity_hint: "high"















  priority: "high"































- id: flow_unencrypted















  title: "Dataflow potentially unencrypted"















  description: "A dataflow has no encryption metadata; sensitive data may be in transit without TLS."















  when:















    target: "flow"















    requires_encryption: true















  mitigations:















    - "Encrypt the flow between {component_id} endpoints using TLS 1.2+ or mTLS."















    - "Use HSTS and TLS pinning for public clients where applicable."















  stride: "Information Disclosure"















  severity_hint: "high"















  priority: "high"































- id: datastore_no_encryption















  title: "Datastore missing encryption metadata"















  description: "Datastore component has no encryption metadata; sensitive data might be stored unencrypted."















  when:















    target: "component"















    component_type: "datastore"















    properties:















      encrypted:















        exists: false















  mitigations:















    - "Enable encryption at rest (KMS) for datastore {component_id}."















    - "Apply access controls and rotate keys regularly."















  stride: "Information Disclosure"















  severity_hint: "high"















  priority: "high"































- id: iac_public_bucket















  title: "Public cloud storage or resource"















  description: "IaC describes a publicly exposed storage bucket or resource (e.g., aws_s3_bucket public ACL)."















  when:















    target: "component"















    component_type: "aws_s3_bucket"















    properties:















      public:















        equals: true















  mitigations:















    - "Make S3 bucket {component_id} private, remove public ACL, and use bucket policies and block public access."















    - "Scan for accidental public exposure in CI and fail builds when public=true on storage resources."















  stride: "Information Disclosure"















  severity_hint: "high"















  priority: "high"































- id: default_high_risk_admin















  title: "High risk: admin or sensitive operation"















  description: "Generic rule to warn on potential admin operations."















  when:















    target: "flow"















    path_contains: "/manage"















  mitigations:















    - "Ensure strong authorization and auditing for {component_id} operations."















  stride: "Elevation of Privilege"















  severity_hint: "medium"















  priority: "medium"















